<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Understanding AI Diagnostic Tools: Confusion Matrix</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <header class="site-header">
        <a href="https://med.stanford.edu/ai-in-meded.html" target="_blank">
            <img src="assets/logo.png" alt="Stanford Medicine - AI in Medical Education">
        </a>
    </header>
    <div class="container">
        <!-- Header -->
        <div class="card">
            <h1>Evaluating AI Diagnostic Tools</h1>
             <p class="authors">Vishnu Ravi, MD &bull; Alaa Youssef, PhD &bull; Aydin Zahedivash, MD &bull; Gabriel Tse, MD &bull; Jonathan Chen, MD, PhD</p>

            <div class="scenario-box">
                <h3>Why This Matters</h3>
                <p>AI-powered diagnostic tools are increasingly used in clinical settings. As a clinician, you need to understand how to interpret their performance metrics to make informed decisions about when to trust these tools and how to use them appropriately.</p>
                <p style="margin-top: 10px;">This tutorial uses a <strong>chest X-ray AI for pneumonia detection</strong> as an example. The same principles apply to any diagnostic AI tool.</p>
            </div>
        </div>

        <!-- Interactive Threshold Visualization -->
        <div class="card">
            <h2>Interactive: Explore AI Diagnostic Performance</h2>

            <p style="margin-bottom: 25px;">This is a <strong>binary classifier</strong>—it predicts pneumonia vs. no pneumonia. The AI assigns each X-ray a <strong>confidence score</strong> (0-100%) indicating how likely pneumonia is present. A <strong>threshold</strong> determines the cutoff: scores above the threshold are flagged as "Pneumonia Detected." Drag the threshold line to see how the metrics change. Try three different scenarios to see how AI performance changes based on case difficulty and prevalence.</p>

            <div class="viz-row">
                <div class="viz-left">
                    <div class="dataset-selector">
                        <button class="dataset-btn active" onclick="setDataset('separated', this)">Severe Cases</button>
                        <button class="dataset-btn" onclick="setDataset('unseparated', this)">Subtle Cases</button>
                        <button class="dataset-btn" onclick="setDataset('imbalanced', this)">Low Prevalence</button>
                    </div>
                    <div class="dataset-explanation" id="datasetExplanation">
                        <strong>Severe Cases:</strong> ICU patients with large lobar pneumonia and high fevers. The AI easily distinguishes these obvious cases from healthy patients. This represents ideal conditions — but an AI validated only on severe cases may struggle with your more subtle outpatients.
                    </div>
                    <div class="threshold-viz-container">
                        <div class="distribution-chart" id="distributionChart">
                            <div class="zone-labels">
                                <span class="predicted-negative-zone">← AI predicts: No Pneumonia</span>
                                <span class="predicted-positive-zone">AI predicts: Pneumonia →</span>
                            </div>
                            <div class="chart-area" id="chartArea">
                                <div class="threshold-line" id="thresholdLine">
                                    <div class="threshold-label" id="thresholdLabel">Threshold: 50%</div>
                                </div>
                            </div>
                            <div class="chart-axis">
                                <span class="axis-label" style="left: 0%;">0%</span>
                                <span class="axis-label" style="left: 25%;">25%</span>
                                <span class="axis-label" style="left: 50%;">50%</span>
                                <span class="axis-label" style="left: 75%;">75%</span>
                                <span class="axis-label" style="left: 100%;">100%</span>
                            </div>
                        </div>
                        <p class="axis-title">AI Confidence Score (probability of pneumonia)</p>

                        <div class="legend">
                            <div class="legend-item">
                                <div class="legend-dot" style="background: #175E54;"></div>
                                Healthy patient
                            </div>
                            <div class="legend-item">
                                <div class="legend-dot" style="background: #B83A4B;"></div>
                                Patient with pneumonia
                            </div>
                        </div>
                    </div>
                </div>

                <div class="viz-right">
                    <!-- Confusion Matrix -->
                    <div class="matrix-container">
                        <div class="matrix-labels-top">
                            <div></div>
                            <div>AI: Pneumonia</div>
                            <div>AI: No Pneumonia</div>
                        </div>
                        <div class="matrix-row">
                            <div class="matrix-row-label">Actually Has<br>Pneumonia</div>
                            <div class="matrix-cell tp" id="tpCell">
                                <span class="label">True Positive</span>
                                <span class="count" id="tpCount">25</span>
                            </div>
                            <div class="matrix-cell fn" id="fnCell">
                                <span class="label">False Negative</span>
                                <span class="count" id="fnCount">5</span>
                            </div>
                        </div>
                        <div class="matrix-row">
                            <div class="matrix-row-label">Actually<br>Healthy</div>
                            <div class="matrix-cell fp" id="fpCell">
                                <span class="label">False Positive</span>
                                <span class="count" id="fpCount">10</span>
                            </div>
                            <div class="matrix-cell tn" id="tnCell">
                                <span class="label">True Negative</span>
                                <span class="count" id="tnCount">60</span>
                            </div>
                        </div>
                    </div>

                    <!-- ROC Curve -->
                    <div class="roc-container">
                        <h4>ROC Curve</h4>
                        <div class="roc-chart">
                            <canvas id="rocCanvas" width="300" height="240"></canvas>
                            <div class="roc-labels">
                                <span class="roc-ylabel">Recall (TPR)</span>
                                <span class="roc-xlabel">False Positive Rate</span>
                            </div>
                        </div>
                        <div class="auc-display">AUC: <span id="aucValue">0.85</span></div>
                    </div>
                </div>
            </div>

            <!-- Metrics -->
            <div class="metrics-grid">
                <div class="metric-card" id="accuracyCard">
                    <div class="metric-name">Accuracy</div>
                    <div class="metric-value" id="accuracy">85%</div>
                    <div class="metric-formula">(TP+TN) / Total</div>
                </div>
                <div class="metric-card" id="recallCard">
                    <div class="metric-name">Recall</div>
                    <div class="metric-value" id="recall">83%</div>
                    <div class="metric-formula">TP / (TP+FN)</div>
                </div>
                <div class="metric-card" id="fprCard">
                    <div class="metric-name">False Positive Rate</div>
                    <div class="metric-value" id="fpr">14%</div>
                    <div class="metric-formula">FP / (FP+TN)</div>
                </div>
                <div class="metric-card" id="precisionCard">
                    <div class="metric-name">Precision</div>
                    <div class="metric-value" id="precision">71%</div>
                    <div class="metric-formula">TP / (TP+FP)</div>
                </div>
                <div class="metric-card" id="f1Card">
                    <div class="metric-name">F1 Score</div>
                    <div class="metric-value" id="f1">77%</div>
                    <div class="metric-formula">2·P·R / (P+R)</div>
                </div>
            </div>

            <div class="implications-box">
                <h3>Clinical Interpretation</h3>
                <p id="clinicalInterpretation">
                    With this threshold, the AI correctly classifies <strong id="accuracyText">85%</strong> of all cases (accuracy)
                    and catches <strong id="recallText">83%</strong> of pneumonia cases (recall).
                    However, <strong id="fprText">14%</strong> of healthy patients receive false alarms (false positive rate).
                </p>
            </div>
        </div>

        <!-- Collapsible Sections -->

        <!-- What do these terms mean? -->
        <div class="accordion">
            <div class="accordion-header">
                <h2>What do these terms mean?</h2>
                <span class="accordion-icon">+</span>
            </div>
            <div class="accordion-content">
                <p>When an AI tool makes a prediction, there are four possible outcomes based on whether the prediction was correct and what the actual condition is:</p>

                <div class="quadrant-grid-container">
                    <div class="quadrant-labels-top">
                        <div></div>
                        <div>AI: Pneumonia</div>
                        <div>AI: No Pneumonia</div>
                    </div>
                    <div class="quadrant-row">
                        <div class="quadrant-row-label">Actually Has<br>Pneumonia</div>
                        <div class="quadrant-card tp-card">
                            <h4>True Positive (TP)</h4>
                            <p><strong>AI says:</strong> Pneumonia detected<br>
                            <strong>Reality:</strong> Patient has pneumonia<br>
                            <em>Correct alert — patient receives treatment</em></p>
                        </div>
                        <div class="quadrant-card fn-card">
                            <h4>False Negative (FN)</h4>
                            <p><strong>AI says:</strong> No pneumonia<br>
                            <strong>Reality:</strong> Patient has pneumonia<br>
                            <em>Missed case — delayed treatment</em></p>
                        </div>
                    </div>
                    <div class="quadrant-row">
                        <div class="quadrant-row-label">Actually<br>Healthy</div>
                        <div class="quadrant-card fp-card">
                            <h4>False Positive (FP)</h4>
                            <p><strong>AI says:</strong> Pneumonia detected<br>
                            <strong>Reality:</strong> Patient is healthy<br>
                            <em>False alarm — unnecessary treatment</em></p>
                        </div>
                        <div class="quadrant-card tn-card">
                            <h4>True Negative (TN)</h4>
                            <p><strong>AI says:</strong> No pneumonia<br>
                            <strong>Reality:</strong> Patient is healthy<br>
                            <em>Correct clearance — patient reassured</em></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Clinical Scenarios -->
        <div class="accordion">
            <div class="accordion-header">
                <h2>Clinical Scenarios to Try</h2>
                <span class="accordion-icon">+</span>
            </div>
            <div class="accordion-content">
                <p>Use the interactive demo above to explore these clinical scenarios:</p>

                <div class="scenario-box" style="margin-bottom: 15px;">
                    <h3>1. Screening</h3>
                    <p>You don't want to send anyone with pneumonia home from the ED. Using <strong>"Severe Cases"</strong>, where would you set the threshold?</p>
                </div>

                <div class="scenario-box" style="margin-bottom: 15px;">
                    <h3>2. Confirmatory</h3>
                    <p>You want to avoid unnecessary antibiotics and further workup. Using <strong>"Subtle Cases"</strong>, where would you set the threshold?</p>
                </div>

                <div class="scenario-box" style="margin-bottom: 15px;">
                    <h3>3. Low Prevalence</h3>
                    <p>Set the threshold to 50% in <strong>"Subtle Cases"</strong>, note the precision. Now switch to <strong>"Low Prevalence"</strong> at the same threshold. What happened to precision, and why?</p>
                </div>
            </div>
        </div>

        <!-- Understanding Tradeoffs -->
        <div class="accordion">
            <div class="accordion-header">
                <h2>Understanding the Tradeoffs</h2>
                <span class="accordion-icon">+</span>
            </div>
            <div class="accordion-content">
                <p>Notice what happens when you move the threshold:</p>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                    <div style="background: #e8f4f2; padding: 20px; border-radius: 10px; border-left: 4px solid #175E54;">
                        <h3 style="color: #175E54; margin-bottom: 10px;">Lower Threshold (←)</h3>
                        <ul style="margin-left: 20px; color: #175E54;">
                            <li>More cases flagged as positive</li>
                            <li><strong>Higher recall</strong> — catch more true pneumonia</li>
                            <li><strong>Higher false positive rate</strong> — more false alarms</li>
                            <li>Fewer missed cases, more unnecessary workup</li>
                        </ul>
                    </div>
                    <div style="background: #fef5f5; padding: 20px; border-radius: 10px; border-left: 4px solid #8C1515;">
                        <h3 style="color: #8C1515; margin-bottom: 10px;">Higher Threshold (→)</h3>
                        <ul style="margin-left: 20px; color: #820000;">
                            <li>Fewer cases flagged as positive</li>
                            <li><strong>Lower recall</strong> — miss more true pneumonia</li>
                            <li><strong>Lower false positive rate</strong> — fewer false alarms</li>
                            <li>More missed cases, less unnecessary workup</li>
                        </ul>
                    </div>
                </div>

                <div class="scenario-box">
                    <h3>Clinical Context Matters</h3>
                    <p><strong>Emergency screening:</strong> Use a lower threshold. Missing pneumonia in a sick patient (false negative) is dangerous. Accept more false positives that can be ruled out with further testing.</p>
                    <p style="margin-top: 10px;"><strong>Confirmatory testing:</strong> Use a higher threshold. You want high confidence before initiating aggressive treatment. False positives lead to unnecessary interventions.</p>
                </div>
            </div>
        </div>

        <!-- Quick Reference -->
        <div class="accordion">
            <div class="accordion-header">
                <h2>Quick Reference: Key Metrics</h2>
                <span class="accordion-icon">+</span>
            </div>
            <div class="accordion-content">
                <table style="width: 100%; border-collapse: collapse; margin: 15px 0;">
                    <thead>
                        <tr style="background: #edf2f7;">
                            <th style="padding: 12px; text-align: left; border-bottom: 2px solid #cbd5e0;">Metric</th>
                            <th style="padding: 12px; text-align: left; border-bottom: 2px solid #cbd5e0;">Question It Answers</th>
                            <th style="padding: 12px; text-align: left; border-bottom: 2px solid #cbd5e0;">Formula</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="padding: 12px; border-bottom: 1px solid #e2e8f0;"><strong>Accuracy</strong></td>
                            <td style="padding: 12px; border-bottom: 1px solid #e2e8f0;">Of all cases, how many did the AI classify correctly?</td>
                            <td style="padding: 12px; border-bottom: 1px solid #e2e8f0; font-family: monospace;">(TP + TN) / Total</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px; border-bottom: 1px solid #e2e8f0;"><strong>Recall</strong><br><span style="color: #718096; font-size: 0.85em;">(Sensitivity, TPR)</span></td>
                            <td style="padding: 12px; border-bottom: 1px solid #e2e8f0;">Of all patients WITH pneumonia, how many did the AI catch?</td>
                            <td style="padding: 12px; border-bottom: 1px solid #e2e8f0; font-family: monospace;">TP / (TP + FN)</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px; border-bottom: 1px solid #e2e8f0;"><strong>False Positive Rate</strong><br><span style="color: #718096; font-size: 0.85em;">(FPR)</span></td>
                            <td style="padding: 12px; border-bottom: 1px solid #e2e8f0;">Of all HEALTHY patients, how many did the AI incorrectly flag?</td>
                            <td style="padding: 12px; border-bottom: 1px solid #e2e8f0; font-family: monospace;">FP / (FP + TN)</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px; border-bottom: 1px solid #e2e8f0;"><strong>Precision</strong><br><span style="color: #718096; font-size: 0.85em;">(PPV)</span></td>
                            <td style="padding: 12px; border-bottom: 1px solid #e2e8f0;">If AI says "pneumonia," how likely is it actually pneumonia?</td>
                            <td style="padding: 12px; border-bottom: 1px solid #e2e8f0; font-family: monospace;">TP / (TP + FP)</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px; border-bottom: 1px solid #e2e8f0;"><strong>F1 Score</strong></td>
                            <td style="padding: 12px; border-bottom: 1px solid #e2e8f0;">Overall balance between precision and recall (harmonic mean)</td>
                            <td style="padding: 12px; border-bottom: 1px solid #e2e8f0; font-family: monospace;">2·P·R / (P + R)</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="js/script.js"></script>
</body>
</html>
